name: Frontend CI
on:
    push:
        branches: [ main, dev ]
        paths:
            - 'backend/**'
    pull_request:
        branches: [ main ]
        paths:
            - 'backend/**'

jobs:
    lint-and-test:
        runs-on: ubuntu-latest
        steps:
            - uses: actions/checkout@v4

            - name: Setup Python
              uses: actions/setup-python@v5
              with:
                python-version: '3.12'
                cache: 'pip'

            - name: Run pre-commit
              uses: pre-commit/action@v3.0.1
              with:
                extra_args: --files $(find backend -type f)

            - name: Install dependencies
              run: |
                python -m pip install --upgrade pip
                pip install -r backend requirements.txt
                pip install pytest testcontainers[postgres]

            - name: Run Tests
              working-directory: ./backend
              run: pytest
              env:
                DATABASE_URL: postgresql://test:test@localhost:5432/testdb
